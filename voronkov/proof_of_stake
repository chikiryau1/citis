'''Доказательство доли владения, Proof-of-stake (PoS)''' (от {{lang-en|proof of stake}}, дословно: «подтверждение доли») — метод защиты в [[криптовалюта]]х, при котором вероятность формирования участником очередного блока в [[блокчейн]]е пропорциональна доле, которую составляют принадлежащие этому участнику расчётные единицы данной криптовалюты от их общего количества. Данный метод является альтернативой методу [[Proof-of-work|подтверждения выполнения работы]] (PoW), при котором вероятность создания очередного блока выше у обладателя более мощного оборудования<ref name="Cryptocurrencies Without Proof of Work">{{Cite web|url=https://link.springer.com/chapter/10.1007/978-3-662-53357-4_10|title=Cryptocurrencies Without Proof of Work |publisher=Springer.com}}</ref><ref>[https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3131897 Доказательство доли владения. «Proof-of-Stake Algorithmic Methods: A Comparative Summary».] Social Science Research Network (SSRN). 11-03-2018.</ref>. При использовании этого метода алгоритм формирования блока не зависит от мощности оборудования, но с большей вероятностью блок будет сформирован той учётной записью, у которой текущий баланс больше. Например, участник, владеющий 1 % от суммарного количества, в среднем будет генерировать 1 % новых блоков<ref name="Proof of Activity: Extending Bitcoin’s Proof of Work via Proof of Stake">{{Cite web|url=https://eprint.iacr.org/2014/452.pdf|title=Proof of Activity: Extending Bitcoin’s Proof of Work via Proof of Stake}}</ref>. Впервые идея Proof-of-stake была предложена на форуме «Bitcointalk» в 2011 году<ref name="Cryptocurrencies Without Proof of Work" />. Первая реализация протокола PoS была представлена в 2012 году в криптовалюте PPCoin (в настоящее время [[PeerCoin]])<ref name="PPCoin: Peer-to-Peer Crypto-Currency with Proof-of-Stake">{{Cite web|url=https://peercoin.net/assets/paper/peercoin-paper.pdf|title=PPCoin: Peer-to-Peer Crypto-Currency with Proof-of-Stake|accessdate=2017-12-24|archiveurl=https://web.archive.org/web/20171211072318/https://peercoin.net/assets/paper/peercoin-paper.pdf|archivedate=2017-12-11|deadlink=yes}}</ref>. На практике часто встречаются смешанные варианты формирования новых блоков. Например, оба метода PoW и PoS используются в криптовалютах [[EmerCoin|Emerсoin]], [[NovaCoin]], [[YaCoin]]. В криптовалютах [[PeerCoin]] и [[Reddcoin]] метод PoW используется для первоначального распределения, а PoS — для подтверждения [[Транзакция (информатика)|транзакций]]<ref name="=Рассуждения на тему методов защиты криптовалют">{{Cite web|url=https://www.forbes.com/sites/karlwhelan/2013/11/20/so-whats-so-special-about-bitcoin-2/|title=Рассуждения на тему методов защиты криптовалют|accessdate=1 сентября 2014|publisher=11.06.2011{{ref-en}} forbes.com|datepublished=20.11.2013|author=Karl Whelan|archiveurl=|archivedate=}}</ref>. В криптоплатформе [[Nxt]] и [[BlackCoin]] метод PoS используется на всех этапах<ref name="=Рассуждения на тему методов защиты криптовалют" />. == Идея == Идея proof-of-stake заключается в решении проблемы proof-of-work, связанной с большими тратами электроэнергии. Вместо вычислительных мощностей участников, имеет значение количество криптовалюты, находящейся у них на счету. Так, вместо использования большого количества электроэнергии для решения задачи PoW, у участника PoS ограничен процент возможных проверок транзакций. Ограничение соответствует количеству криптовалюты, находящейся на счету у участника<ref name="Cryptocurrencies Without Proof of Work" />. == Доказательство важности == Одним из вариантов комбинированного применения технологии PoS является '''«Доказательство важности»''' (Proof-of-importance, PoI) — алгоритм, использующийся в [[NEM (криптовалюта)|криптовалюте NEM]]. На вероятность получить право сформировать блок влияют три компонента<ref>{{Cite web|url=http://icoci.cms.net.my/PROCEEDINGS/2017/Pdf_Version_Chap07e/PID211-400-405e.pdf|title=Blockchain sadaqa mechanism for disaster aid crowd funding}}</ref>: # количество единиц криптовалюты на балансе (значимыми для PoI являются балансы более, чем оговоренное число единиц, например, не менее 10 тыс. для NEM); # активность аккаунта (число транзакций); # время нахождения аккаунта в сети. С ростом баланса влияние параметров изменяется — с ростом количества единиц криптовалюты на балансе увеличивается влияние 1-го параметра, и снижается влияние 2-го и 3-го параметров (PoI работает почти как PoS). Чем меньше баланс, тем сильнее влияние 2-го и 3-го параметров. Если суммарный объём эмиссии криптовалюты ограничен, то минимальные требования к 1-му параметру формируют максимальное количество претендентов на создание блока. == Преимущества == * Нет необходимости потреблять большое количество электроэнергии для защиты блокчейна. Например, Bitcoin и Ethereum вместе тратят более 1 миллиона долларов, в пересчете на электроэнергию, в день в рамках своих консенсусных механизмов<ref name="A Proof of Stake Design Philosophy">{{Cite web|url=https://medium.com/@VitalikButerin/a-proof-of-stake-design-philosophy-506585978d51|title=A Proof of Stake Design Philosophy|datepublished=|author=Vitalik Buterin}}</ref>. * Из-за отсутствия необходимости потреблять большое количество энергии, снижаются траты участников. Следовательно, нет необходимости повышать количество единиц валюты для мотивации участников<ref name="A Proof of Stake Design Philosophy" />. * Proof-of-stake позволяет использовать алгоритмы [[Теория игр|теории игр]], чтобы эффективно противодействовать централизации<ref>{{Cite web|url=https://steemit.com/cryptocurrency/@yl91owur/pos-vs-pow|title=Pos vs Pow |publisher=steemit.com|datepublished=|author=|archiveurl=|archivedate=}}</ref>. == Недостатки == Аргументы, вызывающие опасения<ref name="PPCoin: Peer-to-Peer Crypto-Currency with Proof-of-Stake"/>: * Доказательство доли владения даёт дополнительную мотивацию к накапливанию средств в одних руках, что может приводить к централизации сети<ref name="Децентрализованный консенсус в Proof-of-stake невозможен.">{{cite web|url=https://download.wpsoftware.net/bitcoin/pos.pdf|title=Децентрализованный консенсус в Proof-of-stake невозможен.|lang=en|publisher=wpsoftware.net|accessdate=23.09.2014|datepublished=28.05.2014|author=Andrew Poelstra|archiveurl=|archivedate=}}</ref>. * Если образуется небольшая группа, которая сконцентрирует у себя достаточно большие средства, она сможет навязывать свои условия функционирования криптовалюты, с которыми будут несогласны большинство [[Миноритарий|миноритариев]], которые не контролируют [[форжинг]]<ref name="Децентрализованный консенсус в Proof-of-stake невозможен."/>. == Реализации == === Peercoin === [[Peercoin]]— система, основанная на «чистом» proof-of-stake, в том смысле, что PoW используется только для начального распределения денежной массы<ref name="Cryptocurrencies Without Proof of Work" />. ==== Генерация блоков ==== Участники сети Peercoin имеют возможность создать блок исходя из следующего условия<ref name="Cryptocurrencies Without Proof of Work" />: <center><math>hash(prevBlocksData, timeInSeconds, txout_A)\le d_0 * coins(txout_A) * timeweight(txout_A) </math></center> <math>timeInSeconds</math> — текущее время, в данном неравенстве ограничивает попытки [[Хеширование|хеширования]] и блокирует создание следующего блока. <math>txout_A</math> — результат транзакции. <math>coins(txout_A)</math> — количество неизрасходованной криптовалюты транзакции. Если у заинтересованной стороны есть ключ, контролирующий <math>txout_A</math>, то она может сгенерировать блок, используя ключ в качестве подписи. Подпись, в данном случае, будет служить доказательством выполнения условия. Например, участник, владеющий 50 единицами криптовалюты, создаст новый блок с вероятностью в 10 раз большей, чем участник, владеющий 5 единицами. <math>timeweight(txout_A)</math> — время, прошедшее с момента включения в блок результата транзакции <math>txout_A</math>. Вероятность сгенерировать следующий блок, сразу после генерации предыдущего очень мала, но она увеличивается со временем. Это позволяет избежать [[Экспоненциальное распределение|экспоненциального распределения]] между выплатами, повышая шансы участников, обладающих небольшим количеством криптовалюты. <math>prevBlocksData</math> — данные предыдущего блока. Участник, владеющий значительной частью всей криптовалюты системы, имеет возможность генерировать значительную часть блоков, так как вероятность генерации блока пропорциональна количеству монет, находящихся у него на счету. Поэтому, время от времени, заинтересованная сторона имеет возможность генерировать цепочки последовательных блоков<ref name="Cryptocurrencies Without Proof of Work" />. <math>d_0</math> — постоянная, которая корректируется так, что блоки генерируются в среднем каждые 10 минут. === CoA === CoA<ref name="Cryptocurrencies Without Proof of Work" /> (chains of activity) частично базируется на основном элементе [[proof-of-activity]], например, на лотерее между активными участниками через процедуру ''follow-the-satoshi'' (satoshi<ref>{{Cite web|url=https://en.bitcoin.it/wiki/Satoshi_%28unit%29|title=Satoshi |publisher=en.bitcoin.it}}</ref> — наименьшая единица криптовалюты, например, для [[биткойн]]а она равна 0.00000001 BTC). ==== Follow-the-satoshi ==== Алгоритм, получающий на вход коэффициент satoshi между нулем и общим числом satoshi в обращении. Далее запрашивает блок, в котором этот satoshi был произведен и отслеживает транзакции, через которые он прошел до тех пор, пока не найдет участника, способного в данный момент потратить его. Например, если у Алисы есть 6 satoshi, а у Боба 2, то вероятность того, что Алиса будет выбрана следующим владельцем какого-либо satoshi в 3 раза выше чем вероятность выбора Боба<ref name="Cryptocurrencies Without Proof of Work" />. ==== Параметры протокола ==== * Количество участников в группе, которая генерирует следующие блоки <math>w\ge 1</math> * Количество произведенных этой группой единиц криптовалюты <math>2^k</math> * Количество генерируемых этой группой блоков <math>l = k * w</math> * Функция <math>h: \{0,1\}^l\rightarrow \{0,1\}^k</math> * Минимальное время между генерацией блоков <math>G_0</math> * Минимальная доля владения <math>C_0</math> * Награда <math>C_1</math>: <math>0\le C_1\le C_0</math> Процесс создания блоков CoA составляет блокчейн, состоящий из групп по <math>l</math> последовательных блоков<ref name="Cryptocurrencies Without Proof of Work" />: <center><math>\underbrace{\square \square ... \square}_{l},\underbrace{\square \square ... \square}_{l},\underbrace{\square \square ... \square}_{l}... </math></center> ==== Правила протокола ==== Правила протокола chains of activity<ref name="Cryptocurrencies Without Proof of Work" />: # Каждый новый блок генерируется одним участником # Каждый новый блок <math>B_i</math> связан с первым битом <math>b_i</math> [[Хеш-сумма|хеша]] <math>hash(B_i)</math> # Временной промежуток между двумя блоками <math>B_i</math> и <math>B_j</math> должен быть не меньше <math>\left| j-i-1 \right| * G_0</math>. Это значит, что, если следующие 4 блока <math>B_i, B_{i+1}, B_{i+2}, B_{i+3}</math> созданы участниками <math>A_i, A_{i+1}, A_{i+2}, A_{i+3}</math>, то временной промежуток между <math>B_{i+3}</math> и <math>B_i</math> должен быть не меньше <math>2G_0</math> # После того, как группа из <math>l</math> блоков <math>B_{i}, B_{i+1}, B_{i+2}, B_{i+3}</math> создана, узлы сети формируют <math>k</math>-битовое начальное состояние (англ. seed) <math>S^{B_{il}} = \sum_{j=1}^{l}b_{ij}</math>, где <math>b_{ij}</math> — входные значения # Далее начальное состояние (англ. seed) <math>S^{B_{il}}</math> используется для получения последовательности тождеств, использующихся для определения следующих <math>l</math> владельцев через алгоритм ''follow-the-satoshi''. # Если полученный satoshi <math>c < C_0</math> не израсходован, то владелец обязан предоставить дополнительную подпись, доказывающую владение хотя бы <math>C_0 - c</math> единицами криптовалюты, иначе участник не сможет сгенерировать новый блок. === Dense-CoA === Dense-CoA<ref name="Cryptocurrencies Without Proof of Work" /> — альтернативная реализация CoA, в которой участники, генерирующие следующие блоки в цепи, заранее неизвестны. В CoA генерация блока осуществляется одним участником, а в Dense-CoA каждый блок создается группой из <math>l</math> участников: <center> <math>\begin{matrix}\begin{align}l \begin{cases} & \bigcirc\quad \bigcirc\quad \bigcirc \\ & \bigcirc\quad \bigcirc\quad \bigcirc \\ & \bigcirc\quad \bigcirc\quad \bigcirc \\ & \ \vdots\qquad \vdots\qquad \vdots \\ & \bigcirc\quad \bigcirc\quad \bigcirc \end{cases}\\ \Downarrow\qquad\ \ \\ \square\quad \square\quad \square\quad \end{align}\end{matrix} </math> </center> Пусть <math>h: \{0,1\}^n\rightarrow \{0,1\}^n</math> — [[необратимая функция]]. Пусть блок <math>B_{i-1}</math> связан с начальным состоянием (англ. seed) <math>S^{B_{i-1}}</math>, сформированным группой из <math>l</math> участников, генерировавших данный блок. Участник <math>A_l</math>, решающий, какие транзакции войдут в следующий блок <math>B_i</math>, определяется с помощью алгоритма ''follow-the-satoshi'' с хеш-функцией <math>hash(i, l, S^{B_{i-1}})</math> в качестве входного значения. Оставшиеся участники <math>A_1, A_2, ..., A_{l-1}</math> определяются тем же алгоритмом, но в качестве входного значения используется <math>hash(i, l, S^{B_{j-1}})</math>, где <math> j \in {1, 2, ..., l-1}</math>. Далее, выбранные <math>A_1, A_2, ..., A_{l-1}</math> принимают участие в процедуре генерации блока <math>B_i</math>, которая состоит из двух этапов: # Каждый участник <math>A_j</math>, где <math> j \in {1, 2, ..., l}</math>, выбирает случайное секретное значение из <math>R_j\in\{0,1\}^n</math> # Каждый участник подписывает сообщение <math>M\stackrel{\mathrm{def}}{=} h(R_1) \circ h(R_2) \circ ... \circ h(R_l) </math> и выкладывает свою подпись <math>sign_{S_{kj}}(M)</math> и прообраз <math>R_j</math> в сеть. Участник <math>A_l</math> подписывает и выкладывает в сеть блок <math>B_i</math>. Блок содержит: транзакции, хеш предыдущего блока <math>B_{i-1}</math>, метку текущего времени, <math>l</math> прообразов <math>R_1, R_2, ..., R_l</math> и совокупность всех подписей <math>\hat{s}(M) = \{sign_{S_{kj}}\}^{l}_{j=1}(M)</math>. Участники используют функцию <math>h</math> для вычисления образов <math>h(R_1), h(R_i), ..., h(R_l)</math>. Эти образы используются для получения <math>M</math>. Далее проверяется допустимость подписи <math>\hat{s}(M)</math> относительно открытых ключей <math>pk_1, pk_2, ..., pk_l</math> участников <math>A_1, A_2, ..., A_l</math>. == Начальное распределение криптовалюты == Для криптовалюты, не использующей proof-of-work, существует один простой способ распределения денег между участниками — проведение [[ICO (криптовалюты)|ICO]]. Однако, в таком случае, подразумевается, что изначально вся валюта контролируется одной стороной, что усложняет процесс децентрализации. Во многих криптосистемах, использующих proof-of-stake, эта проблема решается посредством использования PoW для первоначальной генерации криптовалюты, которая будет циркулировать в системе в дальнейшем. Таким образом, первоначальная стоимость единиц криптовалюты определяется стоимостью их производства<ref name="Cryptocurrencies Without Proof of Work" />. == Критика == Некоторые авторы утверждают, что доказательство доли владения не является идеальным вариантом для распределенного [[консенсус]]ного протокола<ref name="Proof of Activity: Extending Bitcoin's Proof of Work via Proof of Stake"/>. === Ничего на кону === Проблема «ничего на кону» заключается в том, что, в случае консенсусной ошибки, генераторы блоков ничего не теряют, голосуя за несколько ветвей цепочек. Это не позволяет консенсусу когда-либо установиться.<ref name="Proof of Activity: Extending Bitcoin's Proof of Work via Proof of Stake"/> === Двойная трата === Поскольку формирование цепочки требует небольших затрат ресурсов (в отличие от PoW систем), любой может злоупотребить проблемой с попыткой совершить двойную трату средств «бесплатно»<ref name="Proof of Activity: Extending Bitcoin's Proof of Work via Proof of Stake">{{Cite web|url=https://dl.acm.org/citation.cfm?id=2695545|title=Proof of Activity: Extending Bitcoin's Proof of Work via Proof of Stake}}</ref>. === Варианты решения проблем === На практике проекты решали эти проблемы разными путями: * Протокол Slasher, предлагаемый [[Ethereum]], позволяет пользователям «наказывать» мошенников, которые работают в конце более, чем одной ветви цепочки<ref>{{Cite web|url=https://blog.ethereum.org/2014/01/15/slasher-a-punitive-proof-of-stake-algorithm/|title=Slasher: A Punitive Proof-of-Stake Algorithm |date=2014-01-15 |publisher=Ethereum Blog|accessdate=2017-08-11}}</ref>. Такое предполагает, что вы должны дважды подписать создание новой ветви цепочки, и что вы можете быть наказаны, если создадите ответвление без подтверждения доли. Однако протокол Slasher так и не был принят. Разработчики Ethereum пришли к выводу, что доказательства доли в этом случае нетривиальны<ref>{{Cite web|url=https://blog.ethereum.org/2014/10/03/slasher-ghost-developments-proof-stake/|title=Slasher Ghost, and Other Developments in Proof of Stake|date=2014-10-03|publisher=Ethereum Blog|accessdate=2017-08-11}}</ref>. Вместо этого Ethereum был разработан протокол Ethash, использующий PoW<ref>{{cite web |url=http://gavwood.com/paper.pdf |title=Ethereum: A Secure Decentralised Generalised Transaction Ledger |last1=Wood |first1=Gavin |access-date=23 January 2016 |quote=Ethash is the planned PoW algorithm for Ethereum 1.0}}</ref>. * [[Peercoin]] использует подписанные [[Приватный ключ|приватным ключом]] разработчика контрольные точки. Благодаря этому нет возможности переорганизации цепочки блоков ранее последней контрольной точки. В данном случае компромисс заключается в том, что разработчик Peercoin является центральным органом, управляющим цепочкой блоков<ref name="PPCoin: Peer-to-Peer Crypto-Currency with Proof-of-Stake" />. * Протокол [[Nxt]] позволяет реорганизовать последние 720 блоков. Тем не менее, это только искажает проблему: клиент может следовать за вилкой из 721 блока, независимо от того, является ли она самой длинной цепочкой.<ref name="nxt-whitepaper=history-attacks">{{cite web|title=Nxt Whitepaper: History Attack|url=https://wiki.nxtcrypto.org/wiki/Whitepaper:Nxt#History_Attack|website=Nxtwiki|accessdate=2 January 2015|deadlink=yes|archiveurl=https://web.archive.org/web/20150203012031/http://wiki.nxtcrypto.org/wiki/Whitepaper:Nxt#History_Attack|archivedate=2015-02-03}}</ref>. * Гибридный алгоритм PoS и PoW протокола [[Decred]]. В этом случае используется подтверждение доли, зависимое от метки времени алгоритма PoW, которое предложено назвать «Proof-of-Activity» (Доказательство деятельности), где проблема доказательства решается наличием второго доказательного механизма — PoW<ref>{{Статья|автор=Bentov I., Gabizon A., Mizrahi A.|заглавие=Cryptocurrencies without Proof of Work.|ссылка=https://decred.org/research/bentov2015.pdf|язык=|издание=arXiv Cryptography and Security.|тип=|год=2015|месяц=|число=|том=|номер=|страницы=|issn=}}</ref>. == Примечания == {{примечания|2}} {{Криптовалюты}} [[Категория:Криптовалюты]] [[Категория:Информационная безопасность]]
